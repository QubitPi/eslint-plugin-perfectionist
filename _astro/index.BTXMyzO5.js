import{o as L}from"./index.B3rpUGDu.js";import{a as g}from"./index.3whys8t3.js";let w=(e={})=>{let n=g(e);return n.setKey=function(i,a){let f=n.value;typeof a>"u"&&i in n.value?(n.value={...n.value},delete n.value[i],n.notify(f,i)):n.value[i]!==a&&(n.value={...n.value,[i]:a},n.notify(f,i))},n},E=e=>e,d={},r={addEventListener(){},removeEventListener(){}};function m(){try{return typeof localStorage<"u"}catch{return!1}}m()&&(d=localStorage);let h={addEventListener(e,n,i){window.addEventListener("storage",n),window.addEventListener("pageshow",i)},removeEventListener(e,n,i){window.removeEventListener("storage",n),window.removeEventListener("pageshow",i)}};typeof window<"u"&&(r=h);function M(e,n=void 0,i={}){let a=i.encode||E,f=i.decode||E,l=g(n),u=l.set;l.set=o=>{typeof o>"u"?delete d[e]:d[e]=a(o),u(o)};function v(o){o.key===e?o.newValue===null?u(void 0):u(f(o.newValue)):d[e]||u(void 0)}function c(){l.set(d[e]?f(d[e]):n)}return L(l,()=>{if(c(),i.listen!==!1)return r.addEventListener(e,v,c),()=>{r.removeEventListener(e,v,c)}}),l}function S(e,n={},i={}){let a=i.encode||E,f=i.decode||E,l=w(),u=l.setKey,v=(t,s)=>{typeof s>"u"?(i.listen!==!1&&r.perKey&&r.removeEventListener(e+t,o,y),delete d[e+t]):(i.listen!==!1&&r.perKey&&!(t in l.value)&&r.addEventListener(e+t,o,y),d[e+t]=a(s))};l.setKey=(t,s)=>{v(t,s),u(t,s)};let c=l.set;l.set=function(t){for(let s in t)v(s,t[s]);for(let s in l.value)s in t||v(s,void 0);c(t)};function o(t){t.key?t.key.startsWith(e)&&(t.newValue===null?u(t.key.slice(e.length),void 0):u(t.key.slice(e.length),f(t.newValue))):c({})}function y(){let t={...n};for(let s in d)s.startsWith(e)&&(t[s.slice(e.length)]=f(d[s]));for(let s in t)l.setKey(s,t[s])}return L(l,()=>{if(y(),i.listen!==!1)return r.addEventListener(e,o,y),()=>{r.removeEventListener(e,o,y);for(let t in l.value)r.removeEventListener(e+t,o,y)}}),l}export{M as a,S as p};

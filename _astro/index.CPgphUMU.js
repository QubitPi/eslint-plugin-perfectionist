import{o as L}from"./index.B3rpUGDu.js";import{a as g}from"./index.3whys8t3.js";let w=(e={})=>{let n=g(e);return n.setKey=function(s,v){let u=n.value;typeof v>"u"&&s in n.value?(n.value={...n.value},delete n.value[s],n.notify(u,s)):n.value[s]!==v&&(n.value={...n.value,[s]:v},n.notify(u,s))},n},E=e=>e,d={},r={addEventListener(){},removeEventListener(){}};function m(){try{return typeof localStorage<"u"}catch{return!1}}m()&&(d=localStorage);let h={addEventListener(e,n,s){window.addEventListener("storage",n),window.addEventListener("pageshow",s)},removeEventListener(e,n,s){window.removeEventListener("storage",n),window.removeEventListener("pageshow",s)}};typeof window<"u"&&(r=h);function M(e,n=void 0,s={}){let v=s.encode||E,u=s.decode||E,i=g(n),a=i.set;i.set=o=>{let f=v(o);typeof f>"u"?delete d[e]:d[e]=f,a(o)};function c(o){o.key===e?o.newValue===null?a(n):a(u(o.newValue)):d[e]||a(n)}function y(){i.set(d[e]?u(d[e]):n)}return L(i,()=>{if(y(),s.listen!==!1)return r.addEventListener(e,c,y),()=>{r.removeEventListener(e,c,y)}}),i}function S(e,n={},s={}){let v=s.encode||E,u=s.decode||E,i=w(),a=i.setKey,c=(t,l)=>{typeof l>"u"?(s.listen!==!1&&r.perKey&&r.removeEventListener(e+t,o,f),delete d[e+t]):(s.listen!==!1&&r.perKey&&!(t in i.value)&&r.addEventListener(e+t,o,f),d[e+t]=v(l))};i.setKey=(t,l)=>{c(t,l),a(t,l)};let y=i.set;i.set=function(t){for(let l in t)c(l,t[l]);for(let l in i.value)l in t||c(l,void 0);y(t)};function o(t){t.key?t.key.startsWith(e)&&(t.newValue===null?a(t.key.slice(e.length),void 0):a(t.key.slice(e.length),u(t.newValue))):y({})}function f(){let t={...n};for(let l in d)l.startsWith(e)&&(t[l.slice(e.length)]=u(d[l]));for(let l in t)i.setKey(l,t[l])}return L(i,()=>{if(f(),s.listen!==!1)return r.addEventListener(e,o,f),()=>{r.removeEventListener(e,o,f);for(let t in i.value)r.removeEventListener(e+t,o,f)}}),i}export{M as a,S as p};
